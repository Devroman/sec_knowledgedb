# Жизненный цикл веб-приложения на клиенте
Или "все" что происходит на клиенте, где в данном случае под клиентом подразумевается браузер пользователя.

> **Можно пропустить, если хоть раз верстал.**

> Рассматриваем только основу, без сессий, асинхронных запросов и других изысков. Все это будет далее. Сейчас классический случай общения пользователя с сайтом.

## GET запрос
В самом начале клиент отправляет **GET**-запрос, в ответ на который приходит **HTML**-документ.

**HTML** *aka HyperText Markup Language* - язык разметки документов в интернете.

    <!DOCTYPE html>
    <html lang="ru-RU">
        <head>
            <title>Example page</title>
        </head>
        <body>
            <p class="greetings">Hello, username!</p>
        </body>
    </html>

## DOM

При получении, браузер парсит **HTML**, преобразуя текст, выделяя токены, из которых создает ноды, из которых составляет дерево документа, называемое **DOM**(Document Object Model).  

    html
       .
       .-> head
       .     .
       .     .-> title
       .
       .-> body
             .
             .-> p

## Внешние включения

**HTML**-документ может содержать различные внешние включения, например файлы стилей(**CSS**), скрипты(**JS**), картинки, другой медиа-контент или даже встроить внутрь отдельное окно браузера с другим загруженным сайтом(**iframe**).

Включения эти определяются путем к их расположению, например так:  `<script src="http://test.com/test.js">`, соответственно за каждым включением последует как минимум **GET**-запрос(см. [CORS](./cors.md)).

С каждого отдельного **origin**(см. [Same Origin Policy](./sop.md)) или грубо говоря сервера, будут загружены поочередно указанные файлы включений. Очередность оперделяется упоминанием в **html**.

В случае с получением файла стиля (**CSS**) будет запущена процедура, похожая на описанную ранее. Содержимое будет распаршено и будет составлено дерево стилей (**CSSOM**).

Имея **DOM** и **CSSOM** браузер объединяет их создавая **Render Tree**, определяет размеры отдельных описанных элементов, размещая их на странице и на финальном этапе отрисовывает в соответствии с указанными стилями.

Получая файл скрипта, браузер выполнит содержимое тут же. Исключение - это скрипты с аттрибутом `async`.  

> Бразуер выполняет отрисовку элементов сразу, как только ему удается их распарсить, при этом отрисовка блокируется скачиванием файлов включений.

То есть, если в **HTML**-документе сначала определен заголовок, затем встречается **js**-скрипт, после этого тело страницы и в конце **css**-файл, то рендер(отрисовка) произойдет в следующем порядке:  

1. отрисовывается заголовок, неоформоленный,
2. скачивается и выполняется скрипт,
3. отрисовывается тело страницы,
4. загружается **css**-файл, а описанные в нем стили применяются к имеющимся элементам.

При этом скрипты могут подключать еще неограниченное количество внешних ресурсов, либо перезапускать отрисовку, таким образом цикл может выполняться неорганиченное количество раз.  
Например: если скрипт добавляет в **html** новый узел типа `<script>alert();</script>`, то его содержимое сразу выполнится на странице.

## Резюмируя
Важно запомнить, что такое **HTML**, **JS**, в идеале знать оба хотя бы на примитивном уровне.  
С этим могут помочь:

* [HTML Академия](http://htmlacademy.ru/) - достаточно базовых курсов.
* [Онлайн учебник по JavaScript](https://learn.javascript.ru/) - Основного курса будет достаточно, плюс неплохо бы пролистать часть AJAX и COMET из Дополнительного.

[← Назад](../README.md)